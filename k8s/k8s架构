 ä¸€ã€Kubernetes æ¶æ„æ€»è§ˆ
Kubernetes æ˜¯ä¸€ä¸ªå…¸å‹çš„ ä¸»ä»ï¼ˆMaster-Nodeï¼‰æ¶æ„ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š

+----------------------+       +----------------------+
|    Master Node       |<----->|     Worker Node      |
+----------------------+       +----------------------+
| API Server           |       | Kubelet              |
| Scheduler            |       | Kube Proxy           |
| Controller Manager   |       | Container Runtime    |
| etcd (æ•°æ®å­˜å‚¨)     |       | Pods (App å®¹å™¨)     |
+----------------------+       +----------------------+
ğŸ§  äºŒã€æ ¸å¿ƒç»„ä»¶è¯¦è§£
ğŸ§­ æ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰ç»„ä»¶ï¼š
ç»„ä»¶	ä½œç”¨
API Server	æ‰€æœ‰æ“ä½œçš„å…¥å£ï¼Œæä¾› HTTP/REST æ¥å£ï¼Œæ‰€æœ‰ç»„ä»¶ä¸å…¶é€šä¿¡
etcd	åˆ†å¸ƒå¼é”®å€¼æ•°æ®åº“ï¼Œå­˜å‚¨é›†ç¾¤çš„æ‰€æœ‰çŠ¶æ€ï¼ˆå¦‚ Podã€Service é…ç½®ï¼‰
Scheduler	è´Ÿè´£å°† Pod åˆ†é…åˆ°åˆé€‚çš„ Node ä¸Š
Controller Manager	ç®¡ç†å„ç§æ§åˆ¶å™¨ï¼ˆå¦‚ Deploymentã€ReplicaSetï¼‰æ¥ç¡®ä¿æœŸæœ›çŠ¶æ€

âš™ï¸ Node èŠ‚ç‚¹ç»„ä»¶ï¼ˆWorker Nodeï¼‰ï¼š
ç»„ä»¶	ä½œç”¨
Kubelet	æ¯ä¸ªèŠ‚ç‚¹çš„ Agentï¼Œè´Ÿè´£ Pod çš„åˆ›å»ºã€çŠ¶æ€ä¸ŠæŠ¥ç­‰
Kube Proxy	å¤„ç†ç½‘ç»œè½¬å‘ã€Service çš„è´Ÿè½½å‡è¡¡ç­‰
Container Runtime	å®¹å™¨è¿è¡Œæ—¶ï¼Œæ¯”å¦‚ Dockerã€containerdï¼ŒçœŸæ­£è¿è¡Œå®¹å™¨

ğŸ§© ä¸‰ã€Kubernetes å·¥ä½œæµç¨‹ï¼ˆPod è°ƒåº¦æµç¨‹ï¼‰
ä»¥ä¸‹æ˜¯ç”¨æˆ·æäº¤ä¸€ä¸ª Pod åï¼ŒK8s å¦‚ä½•å¤„ç†çš„å®Œæ•´æµç¨‹ï¼š

âœ… kubectl å‘è¯·æ±‚

ç”¨æˆ·æ‰§è¡Œï¼škubectl apply -f pod.yaml

è¯·æ±‚è¢«å‘é€åˆ° API Server

ğŸ“¥ API Server æ ¡éªŒ + å†™å…¥ etcd

æ ¡éªŒè¯·æ±‚åˆæ³•æ€§ï¼Œå†™å…¥ etcdï¼Œå³é›†ç¾¤çŠ¶æ€æ›´æ–°

ğŸ“… Scheduler å‘ç°æœªè°ƒåº¦çš„ Pod

Scheduler ç›‘å¬åˆ°æ–°çš„æœªç»‘å®š Pod

é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ Nodeï¼ˆæ ¹æ®èµ„æºã€äº²å’Œæ€§ç­‰ï¼‰

ğŸ“¤ API Server æ›´æ–°è°ƒåº¦ç»“æœ

Scheduler å°† Pod å’Œ Node çš„ç»‘å®šå…³ç³»å›å†™åˆ° etcd

ğŸ§‘â€ğŸ”§ Kubelet æ‰§è¡Œ Pod åˆ›å»º

å¯¹åº” Node ä¸Šçš„ Kubelet ç›‘å¬åˆ°æ–°ä»»åŠ¡

Kubelet é€šè¿‡ Container Runtime åˆ›å»ºå®¹å™¨

ğŸ›° Kube Proxy è®¾ç½®ç½‘ç»œ

ä¿è¯ Pod èƒ½è¢«è®¿é—®ï¼Œæ›´æ–° iptables/ebtables åšè½¬å‘

ğŸŸ¢ Pod è¿è¡Œä¸­ + çŠ¶æ€ä¸ŠæŠ¥

Kubelet å®šæœŸå‘ API Server æŠ¥å‘Š Pod çŠ¶æ€

API Server ç»Ÿä¸€æ›´æ–°çŠ¶æ€åˆ° etcd

ğŸ•¸ å››ã€Kubernetes ç½‘ç»œæ¨¡å‹ï¼ˆç®€è¦ï¼‰
æ¯ä¸ª Pod æœ‰ä¸€ä¸ªç‹¬ç«‹ IP

æ‰€æœ‰ Pod äº’é€šï¼ˆä¸éœ€è¦ NATï¼‰

Service é€šè¿‡ ClusterIP/NodePort/LoadBalancer æš´éœ²åº”ç”¨

Kube Proxy å®ç°è´Ÿè½½å‡è¡¡å’Œè½¬å‘

ğŸ“ˆ äº”ã€é›†ç¾¤ä¼¸ç¼©/è‡ªæ„ˆå·¥ä½œåŸç†
å¦‚æœ Pod å´©æºƒï¼ŒController Manager ä¼šé‡æ–°åˆ›å»º

Deployment æ§åˆ¶å™¨ä¼šç¡®ä¿å‰¯æœ¬æ•°æ’å®š

HPAï¼ˆHorizontal Pod Autoscalerï¼‰å¯æ ¹æ® CPU è‡ªåŠ¨æ‰©å®¹ Pod

ğŸ§° å…­ã€æ ¸å¿ƒèµ„æºï¼ˆå¯¹è±¡ï¼‰ç®€è¿°
èµ„æº	ä½œç”¨
Pod	æœ€å°éƒ¨ç½²å•å…ƒ
Service	ç½‘ç»œè®¿é—®æŠ½è±¡ï¼Œè´Ÿè½½å‡è¡¡
Deployment	å£°æ˜å¼éƒ¨ç½²ï¼Œæ§åˆ¶å‰¯æœ¬
ConfigMap / Secret	é…ç½®ç®¡ç†
Namespace	å¤šç§Ÿæˆ·éš”ç¦»
Volume	æ•°æ®æŒä¹…åŒ–

âœ… ä¸ƒã€æ€»ç»“ï¼šKubernetes å·¥ä½œæµç¨‹å›¾
[User -> kubectl]
       â†“
[API Server] â‡„ [etcd]
       â†“
 [Scheduler]
       â†“
 [API Server æ›´æ–°ç»‘å®š]
       â†“
 [Kubelet ç›‘å¬æ‰§è¡Œ]
       â†“
 [Container Runtime å¯åŠ¨å®¹å™¨]
       â†“
 [Kube Proxy è®¾ç½®è½¬å‘]
       â†“
 [Pod è¿è¡Œï¼ŒçŠ¶æ€ä¸ŠæŠ¥ API Server]

pod
kubectl run xxx --image=xxxx
kubectl get pod xxx -owide 
kubectl describe pod xxx  å¯ä»¥æŸ¥çœ‹ eventï¼Œæ¥çœ‹åˆ›å»ºpod è¿‡ç¨‹ä¸­æœ‰å“ªäº›é—®é¢˜
1.åˆ†é…node
2.æ‹‰å»é•œåƒ
3.åˆ›å»ºé•œåƒ
4.å¼€å¯é•œåƒ
kubectl delete pod xxx
kubectl exec -it xxx  è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨
yaml
å®¹å™¨ä¸€ï¼š 
labels ç”¨äºæ‰¾åˆ°ä¸€ç»„å®¹å™¨
name:æ‰¾åˆ°ä¸€ä¸ªå®¹å™¨
å®¹å™¨é•œåƒ
å®¹å™¨ç«¯å£å·
å®¹å™¨äºŒï¼š
ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‹‰å–å¤šä¸ªå®¹å™¨
kubectl apply -f xx.yaml

deploymentï¼š
å¤šå‰¯æœ¬ è‡ªæ„ˆ æ‰©å®¹
kubectl create deployment xxx --image=xxx
kubectl get deploy
kubectl get pod -w  ç›‘å¬æ‘¸ä¸ªpodçš„è¡Œä¸º

kubectl create deployment xxx --image=xxx --replicas=3 åˆ›å»ºä¸‰ä¸ªå‰¯æœ¬
yaml
replicas 3

kubectl scale --replicas =5 deployment xxx æ‰©ç¼©å®¹

å‡çº§å’Œå›æ»š
kubectl set image deplyment xxx tomcat=tomcat:newversion --record
kubectl rollout undo --to-revision=xx

service:
ä¸ºä¸€ç»„pod æä¾›å¤–éƒ¨ç½‘ç»œæœåŠ¡ï¼Œå’Œè´Ÿè½½å‡è¡¡
kubectl expose deployment my-tomcat --name=tomcat --port=8080 --type=NodePort

pod æœ‰è‡ªå·±çš„ip:portä½¿ç”¨ä¸€ä¸ªç½‘æ®µ
service ä¹Ÿæœ‰è‡ªå·±çš„IP:portä½¿ç”¨å¦ä¸€ä¸ªç½‘æ®µ
node ä¹Ÿæœ‰è‡ªå·±çš„IPï¼šport  
å†…éƒ¨å¯ä»¥é€šè¿‡ serviceçš„ipè®¿é—®ï¼Œå¤–éƒ¨å¯ä»¥é€šè¿‡nodeçš„ip:port è®¿é—®

volume:
yaml
volumes:
mount ç‚¹
share

pvc
å¯¹nfs å†åˆ†é…
kubectl apply -f xx.yaml
ç”¨æˆ·å¯ä»¥å»ç”³è¯·è¿™éƒ¨åˆ†ç©ºé—´

ingress
é›†ç¾¤é€šè¿‡ ingress å°†å¤–éƒ¨ç½‘ç»œæµé‡æ‰“åˆ°ä¸åŒçš„service, ä¹Ÿå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œ

k8s ç½‘ç»œæ¨¡å‹
åŒä¸€ä¸ªpodä¸­ä¸åŒå®¹å™¨ä¹‹é—´é€šä¿¡
å¤šä¸ªpodé€šä¿¡
pod å’Œserviceé€šä¿¡
é›†ç¾¤å¤–éƒ¨ä¸service é€šä¿¡


